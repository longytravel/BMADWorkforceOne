# Story 1.4: Generate Demo Data JSON Files

**Epic:** Epic 1 - Foundation & Demo Infrastructure
**Story Points:** 5
**Priority:** P0 - CRITICAL (Blocker)

---

## Status

Ready for Review

---

## Story

**As a** developer,
**I want** to generate realistic demo data JSON files (agents, schedules, CvD forecast, compliance rules),
**so that** the application can load and display meaningful data without requiring a backend.

---

## Acceptance Criteria

1. **Given** the application needs agent data, **When** I create `agents.json`, **Then** it should contain 50-100 realistic agents with varied skills, teams, and shift patterns
2. **Given** the application needs schedule data, **When** I create `schedules.json`, **Then** it should contain weekly activities (shifts, breaks, lunches, meetings) for all agents
3. **Given** the application needs demand forecasting, **When** I create `cvd-forecast.json`, **Then** it should contain 672 intervals (7 days × 96 15-minute slots) with realistic call volume patterns
4. **Given** the application needs compliance rules, **When** I create `compliance-rules.json`, **Then** it should contain break spacing rules, max hours without break, and lunch duration requirements
5. **Given** all JSON files are created, **When** I validate them with Zod schemas, **Then** they should pass validation without errors
6. **Given** the JSON files exist, **When** the application attempts to load them, **Then** they should load successfully within 2 seconds (FR20)

---

## Tasks / Subtasks

- [x] Create agents.json with realistic data (AC: 1)
  - [x] Generate 75 agents (target: 50-100 agents)
  - [x] Use realistic names (diverse, international)
  - [x] Assign varied skills: ["Spanish", "Technical", "Sales", "Billing", "Retention", "Manager"]
  - [x] Assign teams: ["Team A", "Team B", "Team C", "Team D"]
  - [x] Define employment types: 60 full-time, 15 part-time
  - [x] Create weekly schedules with varied shift patterns:
    - Morning shifts: 7am-3pm
    - Standard shifts: 9am-5pm
    - Afternoon shifts: 1pm-9pm
    - Part-time shifts: 9am-1pm or 1pm-5pm
  - [x] Initialize metadata (meetingsThisWeek: 0-3, breakAdjustmentsThisWeek: 0-1)

- [x] Create schedules.json with weekly activities (AC: 2)
  - [x] For each agent, create shift blocks matching their weeklySchedule
  - [x] Add break activities (15-min breaks, 2 per 8-hour shift)
  - [x] Add lunch activities (30-min lunch, midday)
  - [x] Add 10-15 pre-existing meetings (randomly distributed)
  - [x] Ensure break spacing complies with rules (2hr min between breaks)
  - [x] Ensure all activities have unique IDs (UUID format)
  - [x] Color-code activities per architecture:
    - Shifts: #3B82F6 (blue)
    - Breaks: #FB923C (orange)
    - Lunch: #A855F7 (purple)
    - Meetings: #10B981 (green)

- [x] Create cvd-forecast.json with demand data (AC: 3)
  - [x] Generate 672 intervals (7 days × 96 15-minute intervals)
  - [x] Use realistic call volume patterns:
    - Weekday peaks: 10am-12pm (80-100 calls/interval), 2pm-4pm (70-90 calls/interval)
    - Weekday low: 7am-9am (30-50 calls), 5pm-7pm (40-60 calls)
    - Weekend: 50% of weekday volume
  - [x] Calculate initial coverage % (agents scheduled / forecasted calls × 100)
  - [x] Assign risk levels: safe (>105%), caution (90-105%), risk (<90%)
  - [x] Include skills breakdown for each interval (which skills are available)

- [x] Create compliance-rules.json (AC: 4)
  - [x] Rule 1: Break spacing - 2-hour minimum between breaks
  - [x] Rule 2: Max hours without break - 5 hours maximum
  - [x] Rule 3: Lunch duration - 30 minutes required
  - [x] Rule 4: Minimum shift duration - 4 hours
  - [x] Set severity levels (error vs warning)
  - [x] Enable all rules by default

- [x] Validate JSON structure with Zod schemas (AC: 5)
  - [x] Create validation script in `src/services/validateDemoData.ts`
  - [x] Define Zod schemas for each JSON file
  - [x] Run validation script manually
  - [x] Fix any validation errors
  - [x] Document expected structure in comments

- [x] Test data loading performance (AC: 6)
  - [x] Measure JSON file sizes (target: ~80KB total)
  - [x] Test loading with fetch() in browser
  - [x] Verify load time < 2 seconds on localhost
  - [x] Optimize if necessary (compress, reduce data)

---

## Dev Notes

### Data Generation Approach

**Option 1: Manual Creation (Recommended for Control)**
- Copy template structures from architecture document
- Use online tools like mockaroo.com or faker.js playground
- Manually adjust for realistic patterns (peak hours, varied shifts)

**Option 2: Script Generation (Faster but Requires Setup)**
- Create Node.js script using `@faker-js/faker`
- Run script to generate JSON files
- Script stored in `/scripts/generateDemoData.js` (not part of app)

**Recommendation:** Manual creation for Epic 1 (better understanding of data structure)

### JSON File Structure Examples

**agents.json (3 agents shown, need 75 total):**
```json
[
  {
    "id": "agent-001",
    "name": "Maria Garcia",
    "email": "maria.garcia@example.com",
    "skills": ["Spanish", "Sales", "Technical"],
    "team": "Team A",
    "employmentType": "full-time",
    "weeklySchedule": {
      "monday": { "startTime": "09:00", "endTime": "17:00", "isWorkingDay": true },
      "tuesday": { "startTime": "09:00", "endTime": "17:00", "isWorkingDay": true },
      "wednesday": { "startTime": "09:00", "endTime": "17:00", "isWorkingDay": true },
      "thursday": { "startTime": "09:00", "endTime": "17:00", "isWorkingDay": true },
      "friday": { "startTime": "09:00", "endTime": "17:00", "isWorkingDay": true },
      "saturday": { "isWorkingDay": false },
      "sunday": { "isWorkingDay": false }
    },
    "metadata": {
      "meetingsThisWeek": 2,
      "breakAdjustmentsThisWeek": 0
    }
  }
]
```

**schedules.json (activities for agents):**
```json
[
  {
    "id": "activity-001",
    "agentId": "agent-001",
    "type": "shift",
    "title": "Regular Shift",
    "startDateTime": "2025-10-20T09:00:00Z",
    "endDateTime": "2025-10-20T17:00:00Z",
    "durationMinutes": 480,
    "isMovable": false,
    "color": "#3B82F6",
    "metadata": {}
  },
  {
    "id": "activity-002",
    "agentId": "agent-001",
    "type": "break",
    "title": "Morning Break",
    "startDateTime": "2025-10-20T10:30:00Z",
    "endDateTime": "2025-10-20T10:45:00Z",
    "durationMinutes": 15,
    "isMovable": true,
    "color": "#FB923C",
    "metadata": {}
  }
]
```

**cvd-forecast.json (intervals):**
```json
[
  {
    "intervalStart": "2025-10-20T09:00:00Z",
    "dayOfWeek": "Monday",
    "timeSlot": "09:00",
    "forecastedCalls": 45,
    "scheduledAgents": 50,
    "coveragePercent": 111,
    "riskLevel": "safe",
    "metadata": {
      "skillsAvailable": ["Spanish", "Technical", "Sales"],
      "peakHour": false
    }
  }
]
```

**compliance-rules.json:**
```json
[
  {
    "id": "rule-001",
    "type": "break-spacing",
    "description": "Minimum 2 hours between breaks",
    "parameters": {
      "minMinutesBetweenBreaks": 120
    },
    "severity": "error",
    "enabled": true
  },
  {
    "id": "rule-002",
    "type": "max-hours-without-break",
    "description": "Maximum 5 hours without a break",
    "parameters": {
      "maxHoursWithoutBreak": 5
    },
    "severity": "error",
    "enabled": true
  },
  {
    "id": "rule-003",
    "type": "lunch-duration",
    "description": "Lunch must be 30 minutes",
    "parameters": {
      "lunchDurationMinutes": 30
    },
    "severity": "error",
    "enabled": true
  }
]
```

### Performance Targets

- **Total JSON Size:** ~80KB (agents ~25KB, schedules ~40KB, cvd-forecast ~15KB, rules ~2KB)
- **Load Time:** < 2 seconds (FR20)
- **Realistic Data:** Patterns should reflect real contact center operations

### Testing

**Testing Standards:**
- Validation: All JSON files pass Zod schema validation
- Load time: Fetch all files in parallel < 2 seconds
- Data integrity: No missing required fields, valid ISO 8601 dates

**Test Validation:**
- Run validation script - all files pass
- Load files in browser console - no errors
- Check coverage calculations - realistic (60-120% coverage)
- Verify peak hours have higher demand (10am-12pm, 2pm-4pm)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-18 | 1.0 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

None - No issues encountered during implementation

### Completion Notes

- Successfully generated all 4 demo data JSON files with realistic data
- agents.json: 75 agents (60 full-time, 15 part-time) with diverse names and skill sets
- schedules.json: 1,418 activities across all agents for a full week (shifts, breaks, lunches, meetings)
- cvd-forecast.json: 672 intervals (7 days × 96 15-minute slots) with realistic call patterns
- compliance-rules.json: 4 rules covering break spacing, max hours, lunch duration, and min shift duration
- All files passed Zod schema validation with 0 errors
- Load performance: 7.98ms (well under 2000ms target for FR20)
- Total data size: 706.9 KB (larger than initial target but realistic for production-like dataset)
- Created reusable generation scripts in /scripts directory for maintainability
- Created validation infrastructure in src/services/validateDemoData.ts for data integrity

### File List

**Source Files:**
- wfm-intelligence-demo/src/services/validateDemoData.ts
- wfm-intelligence-demo/src/services/loadDemoData.ts
- wfm-intelligence-demo/src/test-data-load.html

**Data Files:**
- wfm-intelligence-demo/public/demo-data/agents.json
- wfm-intelligence-demo/public/demo-data/schedules.json
- wfm-intelligence-demo/public/demo-data/cvd-forecast.json
- wfm-intelligence-demo/public/demo-data/compliance-rules.json

**Scripts:**
- scripts/generateSchedules.js
- scripts/generateCvdForecast.js
- scripts/validateDemoData.js
- scripts/testLoadPerformance.js

---

## QA Results

### Review Date: 2025-10-19

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall Grade: Very Good (with one critical fix required)** ⚠️

This story demonstrates excellent engineering discipline with comprehensive validation infrastructure and outstanding performance. However, a critical data-code inconsistency was found that must be addressed.

**Strengths:**
- **Validation Excellence**: Comprehensive Zod schemas for all data files with detailed regex patterns
- **Performance Champion**: 8.24ms load time (243x better than 2000ms target!)
- **Realistic Data**: Thoughtful patterns - peak hours, varied shifts, diverse agent profiles
- **Infrastructure Quality**: Clean separation of scripts, services, and data files
- **Type Safety**: Proper TypeScript in validation/loading services
- **Testability**: Dedicated validation and performance test scripts

**Critical Issue Identified & Resolved:**
- **Color Mismatch** (RESOLVED ✅): Demo data was using Tailwind colors while TypeScript constants defined Microsoft Outlook colors
  - Original Data: `#3B82F6` (blue), `#FB923C` (orange), `#A855F7` (purple), `#10B981` (green)
  - Constants: `#0078D4` (blue), `#00B7C3` (teal), `#8764B8` (purple), `#D13438` (red)
  - **Fix Applied**: Updated colors in generation script and regenerated data

### Refactoring Performed

**Fix Applied by QA (Quinn):**

- **File**: [scripts/generateSchedules.js:11-18](../../scripts/generateSchedules.js#L11-L18)
  - **Change**: Updated COLORS constant to match TypeScript ActivityColors
  - **Why**: Ensure data-code consistency, prevent UI rendering inconsistencies
  - **How**: Changed 4 color hex values from Tailwind palette to Microsoft Outlook palette
  - **Added**: Documentation comment to prevent future mismatches

- **File**: [public/demo-data/schedules.json](../../wfm-intelligence-demo/public/demo-data/schedules.json)
  - **Change**: Regenerated with corrected colors
  - **Verification**: All 1,418 activities now use Microsoft Outlook colors
  - **Validation**: Re-ran validation script - all tests passing ✅

### Compliance Check

- **Coding Standards**: ✓ PASS
  - Type Safety: Explicit types in validation/loading services ✓
  - Pure Functions: Generation scripts use pure functions ✓
  - Data Validation: Comprehensive Zod schemas ✓
  - Proper separation of scripts vs application code ✓

- **Project Structure**: ✓ PASS
  - Data files in public/demo-data/ ✓
  - Scripts in /scripts directory ✓
  - Services in src/services/ ✓
  - Clean organization throughout ✓

- **Testing Strategy**: ✓ PASS
  - Validation script with Zod schemas ✓
  - Performance testing with metrics ✓
  - Manual data integrity checks completed ✓
  - All validation tests passing (75 agents, 1418 schedules, 672 intervals, 4 rules) ✓

- **All ACs Met**: ✓ 6/6 PASS (issue resolved)
  - AC1: 75 agents with realistic data ✓
  - AC2: 1,418 activities created ✓ (colors now match constants)
  - AC3: 672 CvD intervals with realistic patterns ✓
  - AC4: 4 compliance rules defined ✓
  - AC5: All files pass Zod validation ✓
  - AC6: Load time 8.24ms (well under 2000ms) ✓

### Improvements Checklist

**Completed by QA (Quinn):**

- [x] **CRITICAL**: Fixed color mismatch in `scripts/generateSchedules.js`
  - Updated COLORS constant (lines 11-18) to match `src/types/constants.ts` ActivityColors
  - Changed: shift: '#3B82F6' → '#0078D4'
  - Changed: break: '#FB923C' → '#00B7C3'
  - Changed: lunch: '#A855F7' → '#8764B8'
  - Changed: meeting: '#10B981' → '#D13438'
- [x] **CRITICAL**: Regenerated schedules.json with corrected colors (421.7 KB, 1,418 activities)
- [x] **CRITICAL**: Re-ran validation script - all tests passing ✅
- [x] Added documentation comment to prevent future color mismatches

**Optional improvements for future:**

- [ ] Add JSDoc comments to generation scripts (generateSchedules.js, generateCvdForecast.js)
- [ ] Consider adding generation metadata (generatedAt timestamp) to JSON files
- [ ] Consider extracting color constants to shared config file to prevent future mismatches

**Already excellent:**

- [x] Comprehensive Zod validation schemas
- [x] Performance testing infrastructure
- [x] Realistic data patterns and distributions
- [x] Clean code organization
- [x] Proper TypeScript typing
- [x] 75 agents with diverse names and skills
- [x] Break spacing compliance (2hr minimum)
- [x] Realistic call volume patterns

### Security Review

**Status: PASS**

No security concerns:
- Static JSON files with no dynamic generation
- No user input processing
- No external API calls
- No sensitive data in demo files (example.com emails)
- Files served from public directory (appropriate for demo data)

### Performance Considerations

**Status: EXCELLENT** ⭐

Performance exceeds requirements by a large margin:
- **Load Time**: 8.24ms (Target: <2000ms) - **243x better than requirement**
- **Total Size**: 706.9 KB (reasonable for 75 agents with full week schedules)
- **Parallel Loading**: Efficient Promise.all() implementation
- **Production Ready**: Vercel CDN with HTTP/2 will provide even faster delivery

File size breakdown:
- agents.json: 60.9 KB (75 agents)
- schedules.json: 421.7 KB (1,418 activities)
- cvd-forecast.json: 223.4 KB (672 intervals)
- compliance-rules.json: 898 B (4 rules)

### Data Quality Assessment

**Agents (75 total):**
- ✓ Realistic international names (Maria Garcia, James Chen, Aisha Patel)
- ✓ Diverse skill distribution across 6 skill types
- ✓ Balanced team assignment (Team A, B, C, D)
- ✓ Proper employment type ratio (60 full-time, 15 part-time)
- ✓ Varied shift patterns (morning 7am-3pm, standard 9am-5pm, afternoon 1pm-9pm)

**Schedules (1,418 activities):**
- ✓ All shifts match weeklySchedule definitions
- ✓ Break spacing complies with 2hr minimum rule
- ✓ 30-minute lunches positioned midway through shifts
- ✓ 15-minute breaks (2 per 8-hour shift)
- ✓ Colors match TypeScript constants (Microsoft Outlook style) - FIXED ✅

**CvD Forecast (672 intervals):**
- ✓ Complete coverage (7 days × 96 15-minute slots)
- ✓ Realistic call patterns with peaks (10am-12pm, 2pm-4pm)
- ✓ Weekend volume ~50% of weekday
- ✓ Risk levels calculated correctly (safe >105%, caution 90-105%, risk <90%)
- ✓ Skills availability tracking

**Compliance Rules (4 rules):**
- ✓ All required rules present
- ✓ Proper severity levels (error vs warning)
- ✓ Clear descriptions and parameters

### Files Modified During Review

**Modified by QA (Quinn):**
- [scripts/generateSchedules.js](../../scripts/generateSchedules.js) - Updated COLORS constant, added documentation
- [public/demo-data/schedules.json](../../wfm-intelligence-demo/public/demo-data/schedules.json) - Regenerated with corrected colors

### Gate Status

**Gate: PASS** ✅ → [docs/qa/gates/1.4-generate-demo-data-json.yml](../../qa/gates/1.4-generate-demo-data-json.yml)

**Quality Score: 100/100** (all issues resolved)

**Risk Level: LOW**
- Probability: LOW (all quality issues resolved)
- Impact: LOW (foundation work, fully validated)

**NFR Validation:**
- Security: PASS ✓
- Performance: PASS ⭐ (excellent - 8.24ms)
- Reliability: PASS ✓ (color consistency verified)
- Maintainability: PASS ✓ (with prevention comment)

**Resolved Issues:**
1. **DATA-001** (HIGH): Activity colors mismatch - RESOLVED ✅

### Recommended Status

✅ **Ready for Done**

This story is now complete with **exceptional quality**. All critical issues resolved, validation passing, and performance exceeding requirements by 243x. The validation infrastructure, realistic data patterns, and type safety make this an exemplary foundation for the application.

**Fix completed in**: ~3 minutes (as estimated)
